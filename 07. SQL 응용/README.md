# ✏️SQL 응용✏️

## 목차
- 1. 데이터베이스 기본
    - [트랜잭션](#트랜잭션)
- 2. 응용 SQL 작성하기
    - [집계성 SQL 작성](#집계성-SQL-작성)
- 3. 절차형 SQL 활용하기
    - [절차형 SQL](#절차형-SQL)
    - [프로시저](#프로시저)
    - [사용자 정의함수](#사용자-정의함수)
    - [트리거](#트리거)
- 4. 데이터 조작 프로시저 최적화
    - [데이터 조작 프로시저 성능개선](#데이터-조작-프로시저-성능개선)

- [암기](#암기)

---

# 1. 데이터베이스 기본
## 트랜잭션
- 트랜잭션
    - 개념
        - 데이터 보장을 위해 DBMS가 가져야하는 특성이자, DBMS에서 하나의 논리적 기능을 정상적으로 수행하기 위한 작업의 기본 단위
    - 특성
        - ACID
        - 원자성 (Atomicity)
            - 분해가 불가능한 작업의 최소단위로, 연산 전체가 성공 또는 실패로 나뉘어진다.
        - 일관성 (Consistency)
            - 트랜잭션 실행 성공 후 항상 일관된 데이터베이스 상태를 보존해야한다.
        - 격리성 (Isolation)
            - 트랜잭션 실행 중 생성하는 연산의 중간 결과를 다른 트랜잭션이 접근 불가한 특성이다.
        - 영속성 (Durability)
            - 성공한 트랜잭션의 결과는 영속적으로 데이터베이스에 저장하는 특성이다.
    
    - 상태 변화
        - 활동: 초기상태, 트랜잭션 실행 중
        - 부분완료: 마지막 명령문이 실행된 후 [-> commit -> 완료]
        - 완료: 성공적으로 완료된 후
        - 실패: 정상적인 실행이 진행될 수 없을 때 [-> Rollback -> 철회]
        - 철회: 트랜잭션이 취소되고, DB가 트랜잭션 시작 전 상태로 환원
        
    - 트랜잭션 제어(TCL)
        - COMMIT: 트랜잭션을 메모리에 영구적으로 저장하는 명령어
        - ROLLBACK: 트랜잭션 내역을 저장 무효화 시키는 명령어
        - CHECKPOINT: ROLLBACK을 위한 시점을 지정하는 명령어
    
    - 병행 제어(일관성 주요 기법)
        - 개념
            - 다수 사용자 환경에서 여러 트랜잭션을 수행할 때, DB 일관성 유지를 위해 상호작용을 제어하는 기법
        - 목적
            - 데이터베이스 공유 최대화
            - 시스템 활용도 최대화
            - DB 일관성 유지
            - 사용자에 대한 응답시간 최소화
        - 병행제어 미보장 시 문제점
            - **갱현모연**
            - 갱신 손실 : 나중에 실행된 트랜잭션이 덮어쓸 때 발생하는 오류
            - 현황 파악오류: 트랜잭션 중간 수행 결과를 다른 트랜잭션이 참조
            - 모순성: 두 트랜잭션이 동시에 실행되어 일관성 결여
            - 연쇄복귀: 복수의 트랜잭션이 데이터 공유할 때 특정 트랜잭션이 처리를 취소할 경우, 트랜잭션이 처리한 곳의 부분을 취소하지 못하는 오류
        - 병행제어 종류
            - **로 낙타다**
            - 로킹
            - 낙관정 검증
            - 타임스탬프 순서
            - 다중버전 동시성 제어
    - 회복 기법(영속성 주요 기법)
        - 개념
            - 트랜잭션 수행 도중 손상된 DB를 손상되기 이전의 정상적인 상태로 복구시키는 작업
        - 종류
            - ** 회로체크**
            - 로그기반 회복기법
                - 지연 갱신 회복 기법: 트랜잭션이 완료되기 전까지 DB에 기록하지 않음
                - 즉각 갱신 회복 기법: 트랜잭션 수행 중 갱신 결과를 바로 DB에 반영
            - 체크포인트 회복 기법
                - 장애 발생 시 검사점 이후에 처리된 트랜잭션에 대해서만 장애 발생 이전의 상태로 복원
            - 그림자 페이징 회복 기법
                - 트랜잭션 수행 시 복제본을 생성하여 DB 장애 시 이를 이용해 복구

- DDL (Data Definition Language)
    - 개념
        - 데이터 구조를 정의할 때 사용하는 명령어
        - 테이블 구조와 관련된 명령어 (구조의 생성, 변경, 삭제, 이름 변경)
    - 대상
        - **도스테뷰인**
        - 도메인
            - 하나의 속성이 가질 수 있는 원자값의 집합(속성의 데이터 타입, 제약조건 등)
        - 스키마
            - DB 구조, 제약조건 등의 정보
            - 외부 스키마: 사용자, 개발자 관점에서의 논리적 구조, 사용자뷰
            - 개념 스키마: 전체적인 논리 구조, 전체적인 뷰
            - 내부 스키마: 물리적 저장장치 관점
        - 테이블 : 데이터 저장 공간
        - 뷰 : 하나 이상의 물리 테이블에서 유도되는 가상의 테이블
        - 인덱스 : 빠른 검색을 위한 데이터 구조
    - 명령어
        - **크알드트**
        - CREATE : 오브젝트 생성
        - ALTER : 오브젝트 변경
        - DROP : 오브젝트 삭제
            - CASCADE : 참조하는 테이블까지 연쇄적으로 제거
            - RESTRICT: 삭제할 테이블을 참조 중이면, 제거하지 않음
        - TRUNCATE : 오브젝트 내용 삭제
        
- DML (Data Manipulation Language)
    - 데이터 조작어 : 자료들을 입력, 수정, 삭제, 조회하는 언어
    - 명령어
        - **세인업데**
        - SELECT : 조회
        - INSERT : 삽입
        - UPDATE : 수정
        - DELETE : 삭제
        
- DCL (Data Control Language)
    - 데이터 제어어 : DBA가 사용하는 제어용 언어
    - 유형
        - GRANT : 사용 권한 부여 [GRANT 권한 ON 테이블 TO 사용자]
        - REVOKE : 사용 권한 취소 [REVOKE 권한 ON 테이블 FROM 사용자]


# 2. 응용 SQL 작성하기
##집계성 SQL 작성
- 데이터 분석 함수
    - 개념
        - 다중 행 함수 : 복수 행 기준의 데이터를 모아 처리하는 것
    - 종류
        - 집계 함수 : 여러 행으로부터 하나의 결괏값을 반환
            - CONUNT, SUM, AVG, MAX, MIN, STDDEV, VARIAN
        - 그룹 함수 : 중간 합계 분석 데이터 산출
            - ROLLUP, CUBE, GROUPING SETS
        - 윈도 함수 : 온라인 분석 처리 용도로 사용하기 위해 표준 SQL에 추가된 기능 
            - 순위 함수, 행 순서 함수, 그룹 내 비율 함수
    
# 3. 절차형 SQL 활용하기
## 절차형 SQL
- 개념
    - 절차 지향적인 프로그램이 가능하도록 하는 트랜잭션 언어
- 종류
    - 프로시저 : 일련의 쿼리들을 하나의 함수처럼 실행하기 위한 쿼리의 집합
    - 사용자 정의 함수 : 일련의 SQL 처리를 수행하고, 수행 결과를 단일 값으로 반환할 수 있는 절차형 SQL
    - 트리거 : 이벤트가 발생할 때 마다 관련 작업이 자동으로 수행되는 절차형 SQL
    
## 프로시저
- 구성
    - **디비컨 SET**
    - 선언부 (DECLARE)
    - 시작/종료부 (BEGIN/END)
    - 제어부 (CONTROL)
    - SQL
    - 예외부 (EXCEPTION)
    - 실행부 (TRANSACTION)

## 사용자 정의함수
- 구성
    - **디비컨 SER**
    - 선언부 (DECLARE)
    - 시작/종료부 (BEGIN/END)
    - 제어부 (CONTROL)
    - SQL
    - 예외부 (EXCEPTION)
    - 반환부 (RETURN)
    
## 트리거
- 목적
    - 특정 테이블에 대한 데이터 변경을 시작점으로, 그와 관련된 작업을 자동적으로 수행하기 위해 사용한다.
    - 이벤트와 관련된 테이블의 데이터 삽입, 추가, 삭제 작업을 DBMS가 자동적으로 실행시키는 데 활용
    - 데이터 무결성 유지 및 로그 메시지 출력 등 별도 처리를 위해 사용

- 종류
    - 행 트리거 : 데이터 변화가 생길 때마다 실행
    - 문장 트리거 : 트리거에 의해 단 한 번 실행
    
- 구성
    - **디이비컨 SE**
    - 선언부 (DECLARE)
    - 이벤트부 (EVENT)
    - 시작/종료부 (BEGIN/END)
    - 제어부 (CONTROL)
    - SQL
    - 예외부 (EXCEPTION)
    
# 4. 데이터 조작 프로시저 최적화
## 데이터 조작 프로시저 성능개선
- 쿼리 성능 개선의 개념(튜닝)
    - 프로시저에 있는 SQL 실행 계획을 분석, 수정을 통해 최소의 시간으로 우너하는 결과를 얻도록 프로시저를 수정하는 작업
    - SQL 성능개선을 통해 데이터 조작 프로시저의 성능 개선이 가능하다.

- 절차
    - 문제 있는 SQL 식별
    - 옵티마이저 통계 확인
    - SQL 문 재구성
    - 인덱스 재구성
    - 실행계획 유지관리

- 옵티마이저 통계 확인
    - 옵티마이저?
        - SQL을 가장 빠르고 효율적으로 수행할 최적의 처리 경로를 생성해주는 DBMS 내부의 핵심 엔진
        


    
    
---

# 암기
